targets="slir crop symexec crashreason"

defvars() {
	echo SLIR_SOURCES= ${input_base}/{transform_expr,abstractlog,expression,events}.cpp
	echo SLIR_SOURCES+= ${input_base}/{util,memorychunk}.cpp
	echo SLIR_SOURCES+= ${input_base}/{debug,instantiation}.cpp

	cat <<EOF
SLIR_OBJECTS=\$(patsubst %.cpp,%.o,\$(SLIR_SOURCES))
SLIR_DEPS=\$(patsubst %.cpp,%.cpp.d,\$(SLIR_SOURCES))
all_sources+=\$(SLIR_SOURCES) ${input_base}/interpret.cpp ${input_base}/crop.cpp ${input_base}/symexec.cpp ${input_base}/crashreason.cpp
clean_files+=slir.a
EOF
}

rules() {
    cat <<EOF
\$(SLIR_OBJECTS): CPPFLAGS+=-I\$(libvex)/pub
\$(SLIR_DEPS): CPPFLAGS+=-I\$(libvex)/pub
${input_base}/instantiation.o: CPPFLAGS+=-I\$(libvex)/priv
${input_base}/instantiation.cpp.d: CPPFLAGS+=-I\$(libvex)/priv
${input_base}/interpret.o: CPPFLAGS+=-I\$(libvex)/pub
${input_base}/crop.o: CPPFLAGS+=-I\$(libvex)/pub
${input_base}/interpret.cpp.d: CPPFLAGS+=-I\$(libvex)/pub
${input_base}/crop.cpp.d: CPPFLAGS+=-I\$(libvex)/pub
${input_base}/crop.o: CPPFLAGS+=-I\$(libvex)/pub
${input_base}/symexec.o: CPPFLAGS+=-I\$(libvex)/pub
${input_base}/symexec.cpp.d: CPPFLAGS+=-I\$(libvex)/pub
${input_base}/crashreason.o: CPPFLAGS+=-I\$(libvex)/pub
${input_base}/crashreason.cpp.d: CPPFLAGS+=-I\$(libvex)/pub

slir.a: \$(SLIR_OBJECTS)
	rm -f \$@ ; ar rcs \$@ \$^

slir: ${input_base}/interpret.o slir.a libVEX.a
	gcc \$(PROFILE_FLAGS) -lstdc++ \$^ -o \$@

crop: ${input_base}/crop.o slir.a libVEX.a
	gcc \$(PROFILE_FLAGS) -lstdc++ \$^ -o \$@

symexec: ${input_base}/symexec.o slir.a libVEX.a
	gcc \$(PROFILE_FLAGS) -lstdc++ \$^ -o \$@

crashreason: ${input_base}/crashreason.o slir.a libVEX.a
	gcc \$(PROFILE_FLAGS) -lstdc++ \$^ -o \$@
EOF
}